# ุงูุฅุฌุฑุงุกุงุช ุงูุฃูููุฉ - Security Measures

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุชุฃููู ุฌููุน API endpoints ูุญูุงูุฉ ุจูุงูุงุช ุงููุฏูุฑูู (Admins).

---

## 1. ุญูุงูุฉ GET /api/admins
โ **ูุญูู**: ูุง ููุฑุฌุน ูููุงุช ุงููุฑูุฑ ูู ุงูุงุณุชุฌุงุจุฉ

```typescript
// ููุฑุฌุน ุจูุงูุงุช Admins ุจุฏูู ูููุงุช ุงููุฑูุฑ
const sanitizedAdmins = admins.map(({ password, ...admin }) => admin);
```

**ููุงุญุธุฉ**: ูุฐุง ุงูู endpoint ุนุงู ููููู ูุฃู ุดุฎุต ุฑุคูุฉ ุฃุณูุงุก ุงููุณุชุฎุฏููู ูุงูุณูุงุชุ ููู **ุจุฏูู ูููุงุช ุงููุฑูุฑ**.

---

## 2. ุญูุงูุฉ POST /api/admins
โ **ูุญูู ุจููุชุงุญ API**

ูุชุทูุจ ุฅุฑุณุงู ููุชุงุญ API ูู ุงูู headers:

```bash
curl -X POST http://localhost:3000/api/admins \
  -H "Content-Type: application/json" \
  -H "x-api-key: your-secret-key-here" \
  -d '{"username": "new_cafe", "password": "pass123", "theme": "ocean"}'
```

### ููููุฉ ุฅุถุงูุฉ Admin ุฌุฏูุฏ:

1. **ุบููุฑ ููุชุงุญ API ูู `.env.local`**:
   ```env
   ADMIN_API_KEY=ุงุฎุชุฑ-ููุชุงุญ-ุนุดูุงุฆู-ููู-ููุง
   ```

2. **ุงุณุชุฎุฏู ุงูููุชุงุญ ุนูุฏ ุงูุฅุถุงูุฉ**:
   ```bash
   curl -X POST http://localhost:3000/api/admins \
     -H "x-api-key: ุงุฎุชุฑ-ููุชุงุญ-ุนุดูุงุฆู-ููู-ููุง" \
     -H "Content-Type: application/json" \
     -d '{
       "username": "cafe_name",
       "password": "secure_password_123",
       "theme": "ocean",
       "logoUrl": "",
       "backgroundUrl": ""
     }'
   ```

---

## 3. ุญูุงูุฉ PUT /api/admins/[id]
โ **ูุญูู ุจูููุฉ ุงููุฑูุฑ ุงูุญุงููุฉ (ููุท ุนูุฏ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ)**

**ููุงุญุธุฉ ูููุฉ**: ูููุฉ ุงููุฑูุฑ ุงูุญุงููุฉ ูุทููุจุฉ **ููุท** ุนูุฏ ุชุบููุฑ ูููุฉ ุงููุฑูุฑุ ูููุณุช ูุทููุจุฉ ูุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช ุงูุฃุฎุฑู.

```json
{
  "theme": "sunset",
  "logoUrl": "https://example.com/logo.png",
  "backgroundUrl": "https://example.com/bg.jpg",
  "newPassword": "ูููุฉ_ุงููุฑูุฑ_ุงูุฌุฏูุฏุฉ_ุงุฎุชูุงุฑู",
  "currentPassword": "ูุทููุจ_ููุท_ุฅุฐุง_ูุงู_newPassword_ููุฌูุฏ"
}
```

**ููู ูุนูู**:
1. ูุชุญุฏูุซ ุงูุณูุฉ ุฃู ุงูุดุนุงุฑ ุฃู ุงูุฎูููุฉ: ูุง ุญุงุฌุฉ ููููุฉ ุงููุฑูุฑ
2. ูุชุบููุฑ ูููุฉ ุงููุฑูุฑ: ูุฌุจ ุฅุฑุณุงู `currentPassword` ููุชุญูู
3. ุฅุฐุง ูุงูุช ูููุฉ ุงููุฑูุฑ ุฎุงุทุฆุฉุ ููุฑุฌุน ุฎุทุฃ 401 Unauthorized

---

## 4. ุญูุงูุฉ DELETE /api/admins/[id]
โ **ูุญูู ุจููุชุงุญ API**

ูุชุทูุจ ููุณ ููุชุงุญ API ุงููุณุชุฎุฏู ูู POST:

```bash
curl -X DELETE http://localhost:3000/api/admins/ADMIN_ID \
  -H "x-api-key: your-secret-key-here"
```

---

## 5. ูุธุงู Session Token
โ **ูุธุงู ูุตุงุฏูุฉ ูููุฑููุช ุฅูุฏ**

ุชู ุฅุถุงูุฉ ูุธุงู Session Token ูุญูุงูุฉ endpoints ุงูููุงุฆู ูุงูุนูุงุตุฑ. ูุฐุง ุงููุธุงู ูุณูุญ ููุท ูููุณุชุฎุฏููู ุงููุณุฌููู ุฏุฎูููู ุจุฅุฏุงุฑุฉ ุจูุงูุงุชูู.

### ููู ูุนูู Session Token:

1. **ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู** (`POST /api/auth`):
   ```json
   {
     "username": "cafe_name",
     "password": "password123"
   }
   ```
   ููุฑุฌุน ุงูู API:
   ```json
   {
     "id": "admin_id",
     "username": "cafe_name",
     "theme": "ocean",
     "sessionToken": "base64_payload.signature"
   }
   ```

2. **ุชุฎุฒูู ุงูู Token**:
   - ูุชู ุญูุธ ุงูู `sessionToken` ูู `localStorage`
   - ุตูุงุญูุฉ ุงูู token: 24 ุณุงุนุฉ

3. **ุงุณุชุฎุฏุงู ุงูู Token**:
   ```bash
   curl -X POST http://localhost:3000/api/lists \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer YOUR_SESSION_TOKEN" \
     -d '{"name": "ูุงุฆูุฉ ุงููุดุฑูุจุงุช", "itemType": "ูุดุฑูุจ", "adminId": "admin_id"}'
   ```

### ุชูููุฉ ุงูู Token:
- **ุงูุชูููุน**: HMAC-SHA256
- **ุงูุชุดููุฑ**: Base64
- **ุงููุญุชูู**: `{adminId, username, expiresAt}`
- **Secret**: ูุญููุธ ูู `.env.local` (`SESSION_SECRET`)

### Endpoints ุงููุญููุฉ ุจู Session Token:

| Endpoint | HTTP Method | ุงูุญูุงูุฉ | ุงููุตู |
|----------|-------------|---------|-------|
| `/api/lists` | POST | Session Token | ุฅูุดุงุก ูุงุฆูุฉ ุฌุฏูุฏุฉ |
| `/api/lists/[id]` | PUT | Session Token + Ownership | ุชุญุฏูุซ ูุงุฆูุฉ (ูููุงูู ููุท) |
| `/api/lists/[id]` | DELETE | Session Token + Ownership | ุญุฐู ูุงุฆูุฉ (ูููุงูู ููุท) |
| `/api/menu` | POST | Session Token + Ownership | ุฅุถุงูุฉ ุนูุตุฑ ููุงุฆูุฉ (ูููุงูู ููุท) |
| `/api/menu/[id]` | PUT | Session Token + Ownership | ุชุญุฏูุซ ุนูุตุฑ (ูููุงูู ููุท) |
| `/api/menu/[id]` | DELETE | Session Token + Ownership | ุญุฐู ุนูุตุฑ (ูููุงูู ููุท) |

### ุงูุชุญูู ูู ุงูููููุฉ (Ownership):
ูู Admin ูุณุชุทูุน ููุท:
- ุฅูุดุงุก ููุงุฆู ูููุณู
- ุชุนุฏูู ููุงุฆูู ูุนูุงุตุฑู ููุท
- ุญุฐู ููุงุฆูู ูุนูุงุตุฑู ููุท

ุฅุฐุง ุญุงูู Admin ุงููุตูู ูุจูุงูุงุช admin ุขุฎุฑุ ุณูุญุตู ุนูู ุฎุทุฃ `403 Forbidden`.

---

## ููุฎุต ุงูุญูุงูุฉ

| Endpoint | ุงูุญูุงูุฉ | ูู ูุณุชุทูุน ุงููุตูู |
|----------|---------|-------------------|
| `GET /api/admins` | ุฅุฎูุงุก ูููุงุช ุงููุฑูุฑ | ุงูุฌููุน (ุนุงู) |
| `GET /api/admins/[id]` | ุฅุฎูุงุก ูููุฉ ุงููุฑูุฑ | ุงูุฌููุน (ุนุงู) |
| `POST /api/admins` | ููุชุงุญ API | ุตุงุญุจ ุงููุดุฑูุน ููุท |
| `PUT /api/admins/[id]` | ูููุฉ ุงููุฑูุฑ (ุนูุฏ ุงูุชุบููุฑ ููุท) | ุงูุฃุฏูู ููุณู ููุท |
| `DELETE /api/admins/[id]` | ููุชุงุญ API | ุตุงุญุจ ุงููุดุฑูุน ููุท |
| `POST /api/lists` | Session Token + Ownership | ุงูุฃุฏูู ุงููุณุฌู ุฏุฎููู ููุท |
| `PUT/DELETE /api/lists/[id]` | Session Token + Ownership | ูุงูู ุงููุงุฆูุฉ ููุท |
| `POST /api/menu` | Session Token + Ownership | ูุงูู ุงููุงุฆูุฉ ููุท |
| `PUT/DELETE /api/menu/[id]` | Session Token + Ownership | ูุงูู ุงูุนูุตุฑ ููุท |

---

## ุชูุตูุงุช ุฅุถุงููุฉ ููุฅูุชุงุฌ (Production)

1. **ุงุณุชุฎุฏู HTTPS**: ูุง ุชูุฑุณู ูููุงุช ุงููุฑูุฑ ุฃุจุฏุงู ุนุจุฑ HTTP
2. **Hash ูููุงุช ุงููุฑูุฑ**: ุงุณุชุฎุฏู bcrypt ุฃู argon2 ุจุฏูุงู ูู ุงููุต ุงูุนุงุฏู
3. **httpOnly Cookies**: ุงุณุชุจุฏู localStorage ุจู httpOnly cookies ูุชุฎุฒูู session tokens ุจุดูู ุฃูุซุฑ ุฃูุงูุงู
4. **Rate Limiting**: ุญุฏูุฏ ุนุฏุฏ ุงููุญุงููุงุช ูุชุฌูุจ ูุฌูุงุช brute force
5. **Environment Variables**: ูุง ุชูุดุงุฑู `.env.local` ูุน ุฃุญุฏ
6. **ูู Vercel**: ุฃุถู ุงููุชุบูุฑุงุช ุงูุชุงููุฉ ูู Environment Variables:
   - `ADMIN_API_KEY`: ููุชุงุญ API ูุฅุฏุงุฑุฉ ุงูู Admins
   - `SESSION_SECRET`: ููุชุงุญ ุณุฑู ูุชูููุน Session Tokens
7. **ููุฉ ุงูู Secrets**: ุงุณุชุฎุฏู ููุงุชูุญ ุนุดูุงุฆูุฉ ูููุฉ (32+ ุญุฑู)

---

## ุงูุฎูุงุตุฉ

### ุญูุงูุฉ ุจูุงูุงุช Admins:
โ ูุง ูููู ูุฃู ุดุฎุต ุฑุคูุฉ ูููุงุช ุงููุฑูุฑ
โ ูุง ูููู ูุฃู ุดุฎุต ุฅุถุงูุฉ admins ุฌุฏุฏ ุจุฏูู ุงูููุชุงุญ (API Key)
โ ูููุฉ ุงููุฑูุฑ ุงูุญุงููุฉ ูุทููุจุฉ ููุท ูุชุบููุฑ ูููุฉ ุงููุฑูุฑ
โ ูุง ูููู ูุฃู ุดุฎุต ุญุฐู admins ุจุฏูู ุงูููุชุงุญ (API Key)

### ุญูุงูุฉ ุงูููุงุฆู ูุงูุนูุงุตุฑ:
โ ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ูููุตูู ูู endpoints ุงูููุงุฆู ูุงูุนูุงุตุฑ (Session Token)
โ ูู admin ูุณุชุทูุน ููุท ุฅุฏุงุฑุฉ ููุงุฆูู ูุนูุงุตุฑู ุงูุฎุงุตุฉ (Ownership Check)
โ ูุง ูููู ูุฃู admin ุงููุตูู ูุจูุงูุงุช admin ุขุฎุฑ
โ Session Tokens ููููุนุฉ ููุง ูููู ุชุฒููุฑูุง (HMAC-SHA256)

### ูุธุงู ุงูุฃูุงู ุงูุดุงูู:
๐ **ุทุจูุชุงู ูู ุงูุญูุงูุฉ**:
1. **API Key**: ูุฅุฏุงุฑุฉ Admins (ุฎุงุฑุฌ ุงููุฑููุช ุฅูุฏ)
2. **Session Token**: ูุฅุฏุงุฑุฉ ุงูููุงุฆู ูุงูุนูุงุตุฑ (ุฏุงุฎู ุงููุฑููุช ุฅูุฏ ููุท)
